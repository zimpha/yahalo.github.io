<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="pinterest" content="nopin">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.75.0@zimpha" />



<link rel="canonical" href="https://zimpha.github.io/editorials/petrozavodsk/2015-summer/moscow-ipt-contest/">


    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_dark.min.css">
    <title>Petrozavodsk Summer 2015. Day 4. Moscow IPT Contest - zimpha&#39;s blog</title>
    
<meta name="description" content="&lt;h2 id=&#34;a-rectangle-query&#34;&gt;A. Rectangle Query&lt;/h2&gt;&lt;p&gt;题意：强制在线。有 &lt;span class=&#34;math inline&#34;&gt;\(n\)&lt;/span&gt; 个点 &lt;span class=&#34;math inline&#34;&gt;\((x_i, y_i)\)&lt;/span&gt;。给出 &lt;span class=&#34;math inline&#34;&gt;\(q\)&lt;/span&gt; 个询问，每次求出 &lt;span class=&#34;math inline&#34;&gt;\(x_1 \le x_i \le x_2, y_1 \le y_i \le y_2\)&lt;/span&gt; 的所有点中本质不同的 &lt;span class=&#34;math inline&#34;&gt;\(x\)&lt;/span&gt; 坐标和 &lt;span class=&#34;math inline&#34;&gt;\(y\)&lt;/span&gt; 坐标个数。&lt;/p&gt;">

<meta property="og:title" content="Petrozavodsk Summer 2015. Day 4. Moscow IPT Contest - zimpha&#39;s blog">
<meta property="og:type" content="article">
<meta property="og:url" content="https://zimpha.github.io/editorials/petrozavodsk/2015-summer/moscow-ipt-contest/">
<meta property="og:image" content="https://zimpha.github.io/images/default.png">
<meta property="og:site_name" content="zimpha&#39;s blog">
<meta property="og:description" content="&lt;h2 id=&#34;a-rectangle-query&#34;&gt;A. Rectangle Query&lt;/h2&gt;&lt;p&gt;题意：强制在线。有 &lt;span class=&#34;math inline&#34;&gt;\(n\)&lt;/span&gt; 个点 &lt;span class=&#34;math inline&#34;&gt;\((x_i, y_i)\)&lt;/span&gt;。给出 &lt;span class=&#34;math inline&#34;&gt;\(q\)&lt;/span&gt; 个询问，每次求出 &lt;span class=&#34;math inline&#34;&gt;\(x_1 \le x_i \le x_2, y_1 \le y_i \le y_2\)&lt;/span&gt; 的所有点中本质不同的 &lt;span class=&#34;math inline&#34;&gt;\(x\)&lt;/span&gt; 坐标和 &lt;span class=&#34;math inline&#34;&gt;\(y\)&lt;/span&gt; 坐标个数。&lt;/p&gt;">
<meta property="og:locale" content="ja_JP">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="zimpha&#39;s blog">
<meta name="twitter:url" content="https://zimpha.github.io/editorials/petrozavodsk/2015-summer/moscow-ipt-contest/">
<meta name="twitter:title" content="Petrozavodsk Summer 2015. Day 4. Moscow IPT Contest - zimpha&#39;s blog">
<meta name="twitter:description" content="&lt;h2 id=&#34;a-rectangle-query&#34;&gt;A. Rectangle Query&lt;/h2&gt;&lt;p&gt;题意：强制在线。有 &lt;span class=&#34;math inline&#34;&gt;\(n\)&lt;/span&gt; 个点 &lt;span class=&#34;math inline&#34;&gt;\((x_i, y_i)\)&lt;/span&gt;。给出 &lt;span class=&#34;math inline&#34;&gt;\(q\)&lt;/span&gt; 个询问，每次求出 &lt;span class=&#34;math inline&#34;&gt;\(x_1 \le x_i \le x_2, y_1 \le y_i \le y_2\)&lt;/span&gt; 的所有点中本质不同的 &lt;span class=&#34;math inline&#34;&gt;\(x\)&lt;/span&gt; 坐标和 &lt;span class=&#34;math inline&#34;&gt;\(y\)&lt;/span&gt; 坐标个数。&lt;/p&gt;">
<meta name="twitter:image" content="https://zimpha.github.io/images/default.png">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id":"https:\/\/zimpha.github.io\/"
    },
    "headline": "Petrozavodsk Summer 2015. Day 4. Moscow IPT Contest - zimpha\u0027s blog",
    "image": {
      "@type": "ImageObject",
      "url": "https:\/\/zimpha.github.io\/images\/default.png",
      "height": 800,
      "width": 800
    },
    "datePublished": "2020-08-13T03:22:34JST",
    "dateModified": "2020-08-13T03:22:34JST",
    "author": {
      "@type": "Person",
      "name": "zimpha\u0027s blog"
    },
    "publisher": {
      "@type": "Organization",
      "name": "zimpha\u0027s blog",
      "logo": {
        "@type": "ImageObject",
        "url": "https:\/\/zimpha.github.io\/images/logo.png",
        "width": 600,
        "height": 60
      }
    },
    "description": "\u003ch2 id=\u0022a-rectangle-query\u0022\u003eA. Rectangle Query\u003c\/h2\u003e\n\u003cp\u003e题意：强制在线。有 \u003cspan class=\u0022math inline\u0022\u003e\\(n\\)\u003c\/span\u003e 个点 \u003cspan class=\u0022math inline\u0022\u003e\\((x_i, y_i)\\)\u003c\/span\u003e。给出 \u003cspan class=\u0022math inline\u0022\u003e\\(q\\)\u003c\/span\u003e 个询问，每次求出 \u003cspan class=\u0022math inline\u0022\u003e\\(x_1 \\le x_i \\le x_2, y_1 \\le y_i \\le y_2\\)\u003c\/span\u003e 的所有点中本质不同的 \u003cspan class=\u0022math inline\u0022\u003e\\(x\\)\u003c\/span\u003e 坐标和 \u003cspan class=\u0022math inline\u0022\u003e\\(y\\)\u003c\/span\u003e 坐标个数。\u003c\/p\u003e"
  }
</script>


    <link href="https://zimpha.github.io/css/styles.css" rel="stylesheet">
    
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$','$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
        }
      };
    
      window.addEventListener('load', (event) => {
          document.querySelectorAll("mjx-container").forEach(function(x){
            x.parentElement.classList += 'has-jax'})
        });
    
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  </head>

  <body>
    
    
    

    <header class="l-header">
      <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://zimpha.github.io/">zimpha&#39;s blog</a>
          </div>

          <div id="navbar" class="collapse navbar-collapse">
            
            <ul class="nav navbar-nav navbar-right">
              
              <li><a href="/about/">About</a></li>
              
            </ul>
            
            <ul class="nav navbar-nav navbar-right">
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Resources <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  
                  <li><a href="/algonotes/">Algorithm Notes</a></li>
                  
                  <li><a href="/resource/problems">Problem Settings</a></li>
                  
                  <li><a href="/resource/translation/">Transalation</a></li>
                  
                </ul>
              </li>
              
            </ul>
            
            <ul class="nav navbar-nav navbar-right">
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tools <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  
                  <li><a href="/tools/generator">Generator</a></li>
                  
                  <li><a href="/tools/algorithmic-library">Algorithmic Library</a></li>
                  
                </ul>
              </li>
              
            </ul>
            
            <ul class="nav navbar-nav navbar-right">
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Editorials <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  
                  <li><a href="/editorials/project-euler">Project Euler</a></li>
                  
                  <li><a href="/editorials/opencup">Open Cup</a></li>
                  
                  <li><a href="/editorials/petrozavodsk">Petrozavodsk Training Camp</a></li>
                  
                </ul>
              </li>
              
            </ul>
            
            <ul class="nav navbar-nav navbar-right">
              
              <li><a href="/">Home</a></li>
              
            </ul>
            
          </div>

        </div>
      </nav>
    </header>

    <main>
      <div class="container">
        
<div class="row">
  <div class="col-md-8">

    <nav class="p-crumb">
      <ol class="breadcrumb">
        <li><a href="https://zimpha.github.io/"><i class="fa fa-home" aria-hidden="true"></i></a></li>
        
        <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="https://zimpha.github.io/editorials/" itemprop="url"><span itemprop="title">editorials</span></a></li>
        
        <li class="active">Petrozavodsk Summer 2015. Day 4. Moscow IPT Contest</li>
      </ol>
    </nav>

    <article class="single">
  <header>
    <h1 class="title">Petrozavodsk Summer 2015. Day 4. Moscow IPT Contest</h1>
    
    <ul class="p-facts">
        <li><i class="fa fa-calendar" aria-hidden="true"></i><time datetime="2020-08-13T03:22:34JST">2020-08-13</time></li>
        <li>来源: <a href=""></a></li>
        
        

        
      </ul>
  </header>

  

  <div class="article-body"><h2 id="a-rectangle-query">A. Rectangle Query</h2>
<p>题意：强制在线。有 <span class="math inline">\(n\)</span> 个点 <span class="math inline">\((x_i, y_i)\)</span>。给出 <span class="math inline">\(q\)</span> 个询问，每次求出 <span class="math inline">\(x_1 \le x_i \le x_2, y_1 \le y_i \le y_2\)</span> 的所有点中本质不同的 <span class="math inline">\(x\)</span> 坐标和 <span class="math inline">\(y\)</span> 坐标个数。</p>
<p><span class="math inline">\(1 \le n,q \le 50000, 0 \le x_i, y_i \le 500000, 0 \le x_1 < x_2 \le 500000, 0 \le y_1 < y_2 \le 500000\)</span></p>
<p>题解：两种询问是对称的，不妨考虑求本质不同的 <span class="math inline">\(y\)</span> 个数。把所有点按照 <span class="math inline">\((x,y)\)</span> 排序，考虑每个 <span class="math inline">\((x_i,y_i)\)</span> 预处理出 <span class="math inline">\(y_i\)</span> 上次出现的 <span class="math inline">\(x\)</span> 坐标。</p>
<p>也就是说对于每个 <span class="math inline">\(x\)</span>，我们有个 <code>std::vector</code> 来表示某个点 <span class="math inline">\((x,y)\)</span> 的 <span class="math inline">\(y\)</span> 坐标最近一次出现的<span class="math inline">\(x\)</span>坐标<span class="math inline">\(last\)</span>，然后对这个建立线段树。线段树每个节点，按照 <span class="math inline">\(last\)</span> 排序，然后对 <span class="math inline">\(y\)</span> 建立可持久化线段树。</p>
<p>那么对于询问的话，就是在每个对应的线段树节点上询问 <span class="math inline">\(last < x_1\)</span> 情况下有多少 <span class="math inline">\(y\)</span> 满足 <span class="math inline">\(y_1 \le y \le y_2\)</span>。二分出对应的位置，然后直接在可持久化线段树询问即可。</p>
<h2 id="b-game-with-a-fairy">B. Game With A Fairy</h2>
<p>题意：有一个长度为 <span class="math inline">\(n\)</span> 的 <code>01</code> 串，保证至少有一个 <code>1</code>。你可以每次给出一个长度为 <span class="math inline">\(n\)</span> 的 <code>01</code> 串，如果他们做位运算与操作后恰好有一个 <code>1</code>，那么返回 <code>+</code>，否则返回 <code>-</code>。你需要询问最多 <span class="math inline">\(200\)</span> 次使得返回值为 <code>+</code>。</p>
<p><span class="math inline">\(n = 10^4\)</span></p>
<p>题解：考虑每次随机 <span class="math inline">\(1,2,\dots,2^p\)</span> 个 <code>1</code>，可以证明期望 <span class="math inline">\(20\)</span> 次就能询问出 <code>+</code>。</p>
<h2 id="c-portkeys">C. Portkeys</h2>
<p>题意：有 <span class="math inline">\(n\)</span> 个钥匙，你在点 <span class="math inline">\(x_i\)</span> 个时候可以使用这个钥匙，走到任意满足 <span class="math inline">\(l_i \le |x_i-y| \le r_i\)</span> 的 <span class="math inline">\(y\)</span> 处。现在给出 <span class="math inline">\(m\)</span> 个位置 <span class="math inline">\(y_i\)</span>，求出从 <span class="math inline">\(x_1\)</span> 走到 <span class="math inline">\(y_i\)</span> 最少需要使用的钥匙个数。</p>
<p><span class="math inline">\(1 \le n, m \le 2 \cdot 10^5, -10^9 \le x_i, y_i \le 10^9, 0 \le l_i \le r_i \le 10^9\)</span></p>
<p>题解：从 <span class="math inline">\(x_1\)</span> 开始 BFS，用 <code>std::set</code> 维护哪些点没有被访问过，每次就是取出 <code>std::set</code> 里一个区间里的数。</p>
<h2 id="d-maximal-common-subpair">D. Maximal Common Subpair</h2>
<p>题意：字符串对 <span class="math inline">\((x,y)\)</span> 是一个串 <span class="math inline">\(s\)</span> 的子串，当且仅当存在字符串 <span class="math inline">\(u\)</span> 和 <span class="math inline">\(v\)</span> 和 <span class="math inline">\(w\)</span>使得 <span class="math inline">\(s=uxvyw\)</span>。给出两个字符串 <span class="math inline">\(s_1\)</span> 和 <span class="math inline">\(s_2\)</span>，你需要找到一对字符串 <span class="math inline">\((x,y)\)</span> 使得 <span class="math inline">\(|x|+|y|\)</span> 最长，<span class="math inline">\((x,y)\)</span> 分别是 <span class="math inline">\(s_1\)</span> 和 <span class="math inline">\(s_2\)</span> 的子串。</p>
<p><span class="math inline">\(1 \le |s_1|, |s_2| \le 2 \cdot 10^5\)</span></p>
<p>题解：令 <span class="math inline">\(s_1=u_1xv_1yw_1\)</span>，<span class="math inline">\(s_2=u_2xv_2yw_2\)</span>，那么当 <span class="math inline">\(v_1\)</span> 和 <span class="math inline">\(v_2\)</span> 都是空的时候，显然我们仅需要找出 <span class="math inline">\(s_1\)</span> 和 <span class="math inline">\(s_2\)</span> 的最长公共子串即可。接下来假设 <span class="math inline">\(v_1\)</span> 和 <span class="math inline">\(v_2\)</span> 至少有一个非空，不妨令 <span class="math inline">\(v_1\)</span> 非空。</p>
<p>如果我们枚举了 <span class="math inline">\(s_1\)</span> 里某个 <span class="math inline">\(y\)</span>，可以发现 <span class="math inline">\(y\)</span> 一定是极大的，并且所有极大的出现位置中，我们只关心出现位置最晚的。类似的 <span class="math inline">\(x\)</span> 也是极大的，所有出现位置中，我们只关心出现位置最早的。这个在 <span class="math inline">\(s_2\)</span> 其实也是成立的。</p>
<p>于是，我们可以用SAM预处理出所有可行的 <span class="math inline">\(y\)</span> 以及它在 <span class="math inline">\(s_1\)</span> 和 <span class="math inline">\(s_2\)</span> 中出现的最晚位置，分别记为 <span class="math inline">\((l_y, y_1,y_2)\)</span>；对于 <span class="math inline">\(x\)</span> 也可以预处理一下，分别记为 <span class="math inline">\((l_x,x_1,x_2)\)</span>。接下来，考虑枚举一个 <span class="math inline">\((l_y, y_1,y_2)\)</span>，求出最长的 <span class="math inline">\(x\)</span>。可以分成两种情况：</p>
<ul>
<li><span class="math inline">\(x\)</span> 和 <span class="math inline">\(y\)</span> 在 <span class="math inline">\(s_2\)</span> 中没有交集，那么显然就是要求 <span class="math inline">\(x_1+l_x-1 < y_1\)</span> 和 <span class="math inline">\(x_2+l_x-1 < y_2\)</span> 情况下，<span class="math inline">\(l_x\)</span> 的最大值。</li>
<li><span class="math inline">\(x\)</span> 和 <span class="math inline">\(y\)</span> 在 <span class="math inline">\(s_2\)</span> 中有交集，那么显然就是要求 <span class="math inline">\(x_1+l_x-1 < y_1\)</span> 和 <span class="math inline">\(x_2 \le y_2 \le x_2+l_x-1\)</span> 情况下，<span class="math inline">\(y_2-x_2+1\)</span> 的最大值。</li>
</ul>
<p>这两种情况都可以对 <span class="math inline">\(y_1\)</span> 和 <span class="math inline">\(x_1\)</span> 做扫描线，然后树状数组维护 <span class="math inline">\(x_2+l_x\)</span> 对应的最值来解决。</p>
<h2 id="e-k-transpositions">E. <span class="math inline">\(k\)</span>-transpositions</h2>
<p>题意：给出排列 <span class="math inline">\(1,2,\dots,n\)</span>，每次可以选择两个数交换位置。求出最多操作 <span class="math inline">\(k\)</span> 次，能够得到多少本质不同的排列。</p>
<p><span class="math inline">\(1 \le n \le 10^9, 0 \le k \le 3000\)</span></p>
<p>题解：对于一个排列，考虑将其环分解，那么 <span class="math inline">\(n\)</span> 减去环个数就是最少需要的操作次数。因此本题就是求 <span class="math inline">\(n\)</span> 减去环个数不超过 <span class="math inline">\(k\)</span> 的排列个数。</p>
<p>令 <span class="math inline">\(dp(i,j)\)</span> 表示长度为 <span class="math inline">\(i\)</span> 的排列，环分解后恰好有 <span class="math inline">\(j\)</span> 个环并且每个环长度至少是 <span class="math inline">\(2\)</span> 的方案数，那么答案就是 <span class="math inline">\(\sum_{i,j} \binom{n}{i} \cdot dp(i,j)\)</span>。易得 <span class="math inline">\(dp(i,j)=(i-1)(dp(i-1,j)+dp(i-2,j-1))\)</span>。</p>
<h2 id="f-pq-tree">F. PQ tree</h2>
<p>题意：给出 <span class="math inline">\(m\)</span> 个长度为 <span class="math inline">\(n\)</span> 的排列。数有多少本质不同的 <code>PQ tree</code> 可以表示它们。</p>
<p><span class="math inline">\(1 \le n, m \le 500\)</span></p>
<p>题解：把所有排列重新标号使得第一个排列恰好是 <span class="math inline">\(\{1,2,\dots,n\}\)</span> 。那么可以发现，对于树上任意节点，这个节点对应的子树构成的数在所有 <span class="math inline">\(m\)</span> 个排列里一定是连续的。于是可以先预处理出区间 <span class="math inline">\([i, j]\)</span> 是否在所有排列里都是连续的。</p>
<p>令 <span class="math inline">\(dp(i,j)\)</span> 表示区间 <span class="math inline">\([i,j]\)</span> 对应的 <code>PQ tree</code> 的方案数；<span class="math inline">\(P(i,j)\)</span> 表示区间 <span class="math inline">\([i,j]\)</span> 构成了一个 <span class="math inline">\(P\)</span> 节点的方案数；<span class="math inline">\(Q_0(i,j)\)</span> 表示区间 <span class="math inline">\([i,j]\)</span> 构成了一个 <span class="math inline">\(Q\)</span> 节点，并且这个点恰好有两个子树的方案数；<span class="math inline">\(Q_1(i,j)\)</span> 表示区间 <span class="math inline">\([i,j]\)</span> 构成了一个 <span class="math inline">\(Q\)</span> 节点，并且这个点至少有三个子树的方案数。</p>
<p>显然，可以得到如下的转移方程：</p>
<p><span class="math display">\[\begin{align}
dp(i,j) &=& P(i,j)+Q_1(i,j) \\
Q_0(i, j) &=& \sum_{k=i}^{j-1} dp(i, k) \cdot dp(k + 1, j) \\
Q_1(i, j) &=& \sum_{k=i}^{j-1} (Q_0(i,k)+Q_1(i,k)) \cdot dp(k + 1, j) \\
P(i,j) &=& Q_0(i,j)+\sum_{k=i}^{j-1} P(i,k) \cdot dp(k + 1, j)
\end{align}
\]</span></p>
<p>当时对于 <span class="math inline">\(Q_1(i,j)\)</span> 转移有一点限制，并不是所有的 <span class="math inline">\(k\)</span> 都是满足条件的。因为 <span class="math inline">\(Q\)</span> 节点要么是顺序要么是逆序，那么对于一个连续区间 <span class="math inline">\([i,k]\)</span>，扩展的时候一定也是要么顺序，要么逆序的。</p>
<p>我们需要预处理出 <span class="math inline">\(ext(i,k)\)</span> 表示区间 <span class="math inline">\([i,k]\)</span> 在每个排列中只能超一个方向扩展的最长距离 <span class="math inline">\(j\)</span>。只有 <span class="math inline">\(j \le ext(i,k)\)</span> 的 <span class="math inline">\(k\)</span> 才是能够转移的。</p>
<p>具体怎么处理呢，考虑枚举 <span class="math inline">\((i, k)\)</span>，然后对于第 <span class="math inline">\(x\)</span> 个排列，如果有 <span class="math inline">\(rank(i) < rank(k)\)</span>，那么不能扩展到 <span class="math inline">\([i,k]\)</span> 的左边去，也就是</p>
<p><span class="math display">\[ext(i,k) \overset{\min}{\leftarrow} \text{perm}(x, \min_{i \le j \le k} (\text{rank}(j)) - 1) - 1
\]</span></p>
<p>否则不能扩展到 <span class="math inline">\([i,k]\)</span> 的右边边去，也就是</p>
<p><span class="math display">\[ext(i,k) \overset{\min}{\leftarrow} \text{perm}(x, \max_{i \le j \le k} (\text{rank}(j)) + 1) - 1
\]</span></p>
<h2 id="g-random-walking">G. Random Walking</h2>
<p>题意：给出一棵 <span class="math inline">\(n\)</span> 个点的树，每条边边权是 <span class="math inline">\(1\)</span>。有 <span class="math inline">\(q\)</span> 个询问，每次询问从 <span class="math inline">\(u\)</span> 到 <span class="math inline">\(v\)</span> 的期望时间：每次会随机选一条边往外走。</p>
<p><span class="math inline">\(1 \le n \le 10^5, 1 \le q \le 2 \times 10^5\)</span></p>
<p>题解：令 <span class="math inline">\(f(v)\)</span> 表示从 <span class="math inline">\(v\)</span> 走到它父亲 <span class="math inline">\(u\)</span> 的期望时间，那么显然有</p>
<p><span class="math display">\[f(v)=\frac{1+\sum_{x \in \text{Son}(v)} (1 + f(x)+f(v))}{\text{deg}(v)}
\]</span></p>
<p>化简得到</p>
<p><span class="math display">\[f(v)=\text{deg}(v)+\sum_{x \in \text{Son}(v)} f(x)
\]</span></p>
<p>令 <span class="math inline">\(g(v)\)</span> 表示从 <span class="math inline">\(v\)</span> 的父亲 <span class="math inline">\(u\)</span> 走到 <span class="math inline">\(v\)</span> 的期望时间，同样可以得到</p>
<p><span class="math display">\[g(v)=\frac{1+(1+g(u)+g(v))+\sum_{x \in \text{Son}(u) \setminus \{v\}}(1+f(x)+g(v))}{\text{deg}(v)}
\]</span></p>
<p>化简得到</p>
<p><span class="math display">\[g(v)=\text{deg}(u)+\sum_{x \in \text{Son}(u) \setminus \{v\}}f(x)
\]</span></p>
<p>对于每个询问，就是先从 <span class="math inline">\(u\)</span> 走到 <span class="math inline">\(\text{lca}(u,v)\)</span>，然后走到 <span class="math inline">\(v\)</span> 即可。需要处理 <span class="math inline">\(f(\cdot)\)</span> 和 <span class="math inline">\(g(\cdot)\)</span> 的前缀和。</p>
<h2 id="h-sasha-and-swag-strings">H. Sasha And Swag Strings</h2>
<p>题意：给出 <span class="math inline">\(n\)</span> 个字符串 <span class="math inline">\(s_1,s_2,\dots,s_n\)</span>。对于每个字符串 <span class="math inline">\(s_i\)</span>，构建出后缀树，对于后缀树上每条边对应的子串，求出本质不同的子串个数，然后求和。</p>
<p><span class="math inline">\(1 \le n \le 10^5, \sum |s_i| \le 5 \cdot 10^5\)</span></p>
<p>题解：先建出后缀树，然后扣出每条边对应的区间。最后套用 <a href="https://raw.githubusercontent.com/zimpha/problem-editorials/master/miscellaneous/stringology.md">How Many Substrings?</a> 的做法，复杂度 <span class="math inline">\(O(n \log^2 n)\)</span>。</p>
<p>别解：考虑建立出 SAM，然后把除了根节点以外的出度为 <span class="math inline">\(1\)</span> 的点都缩掉，这样得到的叫做 CSAM。然后这个东西满足以下性质：</p>
<ul>
<li>trie <span class="math inline">\(\overset{compactation}{\longrightarrow}\)</span> suffix
tree <span class="math inline">\(\overset{minimization}{\longrightarrow}\)</span> CSAM</li>
<li>trie <span class="math inline">\(\overset{minimization}{\longrightarrow}\)</span> SAM <span class="math inline">\(\overset{compactation}{\longrightarrow}\)</span> CSAM</li>
</ul>
<p>然后可以发现 CSAM 那些 compactation 后的边集和 Suffix Tree 的边集是一样的，CSAM 边集长度之和是 <span class="math inline">\(O(n)\)</span> 的。</p>
<p>那么只需要枚举每条边，然后用 SAM 计算出这条边上本质不同子串个数，之后乘上在 Suffix Tree 中出现次数即可。</p>
<p>枚举 CSAM 上的节点 <span class="math inline">\(v\)</span>，它在 Suffix Tree 上出现次数就是这个节点对应的区间长度。</p>
<h2 id="i-tree-confrontation">I. Tree Confrontation</h2>
<p>题意：有一棵 <span class="math inline">\(n\)</span> 个点的树，其中 <span class="math inline">\(a\)</span> 个点被 <code>A</code> 占领了，<span class="math inline">\(b\)</span> 个点被 <code>B</code> 占领了，保证这 <span class="math inline">\(a\)</span> 个点是连通的，这 <span class="math inline">\(b\)</span> 个点是连通的。对于 <code>A</code> 或者 <code>B</code>，它可以选择一个自己占领的城市 <span class="math inline">\(v\)</span>，以及一条路径 <span class="math inline">\(P_1,P_2,\dots,P_k\)</span>，其中 <span class="math inline">\(P_1=v\)</span>，<span class="math inline">\(P_2,P_3,\dots,P_{k-1}\)</span> 都被自己占领，<span class="math inline">\(P_k\)</span> 没有被任何人占领。然后交换 <span class="math inline">\(P_1\)</span> 和 <span class="math inline">\(P_k\)</span> 状态，即 <span class="math inline">\(P_k\)</span> 被占领，<span class="math inline">\(P_1\)</span> 不被任何人占领。</p>
<p>对于两个局面如果能够通过上述操作得到，那么则定义为同一个局面。求出有多少本质不同的局面。</p>
<p><span class="math inline">\(1 \le n \le 200000, 1 \le a, b \le n\)</span></p>
<p>题解：首先可以发现对于任何局面，我们都可以把它们移动成：存在一条边 <span class="math inline">\((u, v)\)</span>，<span class="math inline">\(u\)</span> 所在连通块属于 <code>A</code>，<span class="math inline">\(v\)</span> 所在连通块属于<code>B</code>。于是我们仅需要判断 <span class="math inline">\((u,v)\)</span> 的等价类即可。</p>
<p>对于一条边 <span class="math inline">\((u, v)\)</span>，它能够到达 <span class="math inline">\((v, x)\)</span> 当且仅当 <span class="math inline">\(x\)</span> 那一侧的大小至少是 <span class="math inline">\(a\)</span>。于是可以枚举 <span class="math inline">\(v\)</span>，然后根据上述条件用并查集维护等价类即可。</p>
<p>别解：不妨假设 <span class="math inline">\(a \ge b\)</span>，考虑一定会被 <span class="math inline">\(a\)</span> 霸占的节点。如果存在，那么考虑剩余的森林，答案为其中 <span class="math inline">\(SIZE \ge b\)</span> 的连通块个数；否则，答案要么是 <span class="math inline">\(1\)</span>，要么是 <span class="math inline">\(2\)</span>，答案为 <span class="math inline">\(1\)</span> 当且仅当存在一个节点，使得中有两颗子树的 <span class="math inline">\(SIZE \ge a\)</span>，并存在另一棵子树的 <span class="math inline">\(SIZE \ge b\)</span>。</p>
<h2 id="j-two-airlines">J. Two Airlines</h2>
<p>题意：交互题。有一个 <span class="math inline">\(n\)</span> 个点的无向完全图，每条边标着 <code>A</code> 或者 <code>W</code>。你每次可以询问一条边上标记的字符。用不超过 <span class="math inline">\(2n\)</span> 次，找到一条哈密尔顿回路，使得 <code>A</code> 和 <code>W</code> 只切换过一次。</p>
<p><span class="math inline">\(3 \le n \le 777\)</span></p>
<p>题解：依次加入每个 <span class="math inline">\(i\)</span>，然后维护 <code>A</code> 和 <code>W</code> 构成的序列。考虑当前分界点是 <span class="math inline">\(x\)</span>，那么根据边 <span class="math inline">\((x,i+1)\)</span> 上的字符决定是往 <span class="math inline">\(x\)</span> 左边插入还是右边插入。</p></div>

  <footer class="article-footer">
    
    
    
    
  </footer>

</article>

    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "zimpha" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
    
    
  </div>

  <div class="col-md-4">
    
<aside class="l-sidebar">
    <section class="widget">
        <form id="search" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://zimpha.github.io/">
      <button type="submit" class="submit icon-search glyphicon glyphicon-search"></button>
</form>
    </section>
    <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">LATESTS</div>
    </div>
    <div class="list-group">
      
      <a href="https://zimpha.github.io/editorials/petrozavodsk/2020-summer/warsaw-u-contest/" class="list-group-item">Petrozavodsk Summer 2020. Day 1. Warsaw U Contest</a>
      
      <a href="https://zimpha.github.io/resource/translation/xxvii-poi/" class="list-group-item">XXVII POI Chinese Translation</a>
      
      <a href="https://zimpha.github.io/resource/translation/" class="list-group-item">Translation</a>
      
      <a href="https://zimpha.github.io/editorials/petrozavodsk/2015-winter/jagiellonian-u-contest/" class="list-group-item">Petrozavodsk Winter 2015. Day 6. Jagiellonian U Contest</a>
      
      <a href="https://zimpha.github.io/editorials/petrozavodsk/2015-summer/moscow-ipt-contest/" class="list-group-item">Petrozavodsk Summer 2015. Day 4. Moscow IPT Contest</a>
      
    </div>
  </section>

  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">TAG</div>
    </div>
    <div class="list-group">
      
      
      <a href="https://zimpha.github.io/tags/inclusion-exclusion-principle" class="taglink">inclusion-exclusion-principle</a>
      
      
      
      <a href="https://zimpha.github.io/tags/math" class="taglink">math</a>
      
      
    </div>
  </section>
  

  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">LINKS</div>
    </div>
    <ol class="list-group">
      
      <a href="http://www.cnblogs.com/clrs97/" class="list-group-item">Claris</a>
      
      <a href="http://min-25.hatenablog.com/" class="list-group-item">Min_25</a>
      
      <a href="https://blog.csdn.net/skywalkert/" class="list-group-item">skywalkert</a>
      
    </ol>
  </section>
  

</aside>


  </div>
</div>

      </div>
    </main>

    <footer class="l-footer">
      <div class="container">
        <p><span class="h-logo">&copy; zimpha&#39;s blog</span></p>
        <aside>
          <p>Powered by <a href="https://gohugo.io/">Hugo</a>.</p>
          <p><a href="https://github.com/dim0627/hugo_theme_beg">Beg</a> designed by <a href="http://yet.unresolved.xyz/">Daisuke Tsuji</a>.</p>
        </aside>
      </div>
    </footer>

    <script src="//code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

